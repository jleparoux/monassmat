{% extends "base.html" %}
{% block content %}

<div class="page-header">
  <div>
    <h1 class="page-title">Calendrier mensuel</h1>
    <p class="page-subtitle">Suivi des heures et synthese contractuelle.</p>
  </div>
</div>

<div class="layout">
  <section class="card calendar-card">
    <div class="card__header">
      <div class="toolbar">
        <button class="btn" id="prevMonth" type="button">← Precedent</button>
        <div class="month-picker month-picker--inline" id="monthPicker">
          <button class="month-picker__button" id="monthPickerButton" type="button" aria-haspopup="true" aria-expanded="false">
            <span id="monthPickerLabel">—</span>
          </button>
          <div class="month-picker__panel" id="monthPickerPanel" role="dialog" aria-label="Choisir un mois">
            <div class="month-picker__header">
              <button class="month-picker__nav" id="monthPickerPrevYear" type="button" aria-label="Annees precedentes">←</button>
              <button class="month-picker__year-label" id="monthPickerYearLabel" type="button" aria-label="Choisir une annee">—</button>
              <button class="month-picker__nav" id="monthPickerNextYear" type="button" aria-label="Annees suivantes">→</button>
            </div>
            <div class="month-picker__years" id="monthPickerYears"></div>
            <div class="month-picker__months" id="monthPickerMonths"></div>
            <button class="month-picker__today" id="monthPickerToday" type="button">Mois en cours</button>
          </div>
        </div>
        <button class="btn" id="nextMonth" type="button">Suivant →</button>
      </div>

      <div class="selection-controls">
        <button class="btn btn-secondary" id="toggleSelection" type="button">Selection multiple</button>
        <button class="btn btn-primary" id="editSelection" type="button" disabled>Modifier la selection</button>
        <button class="btn" id="clearSelection" type="button" disabled>Effacer</button>
        <div class="selection-count" id="selectionCount">Aucun jour selectionne</div>
      </div>

      <div class="legend">
        <span class="legend__item"><span class="dot dot--work"></span> travaille</span>
        <span class="legend__item"><span class="dot dot--absence"></span> absence</span>
        <span class="legend__item"><span class="dot dot--assmat"></span> conge assmat</span>
        <span class="legend__item"><span class="dot dot--unpaid"></span> conge sans solde</span>
        <span class="legend__item"><span class="dot dot--holiday"></span> jour ferie</span>
        <span class="legend__item"><span class="dot dot--today"></span> aujourd'hui</span>
      </div>

      <div class="hint selection-hint">Astuce: shift + clic pour selectionner une plage.</div>
    </div>

    <div class="calendar" id="calendar"
         data-contract-id="{{ contract_id }}"
         data-initial-date="{{ initial_date }}">
      <div class="empty">Chargement du mois…</div>
    </div>

    <div class="card__footer">
      <div class="hint">Clique sur un jour pour saisir les heures.</div>
    </div>
  </section>

  <aside class="summary-panel">
    <div class="card">
      <div class="card__header">
        <div class="title">Recapitulatif mensuel</div>
        <div class="muted" id="summaryPeriod">—</div>
      </div>
      <div class="card__body" id="monthSummary">
        <div class="empty">Chargement…</div>
      </div>
    </div>

  </aside>
</div>

<div class="modal" id="dayModal" aria-hidden="true">
  <div class="modal__backdrop" data-close="true"></div>
  <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal__header">
      <div class="title" id="modalTitle">Jour</div>
      <button class="icon-btn" type="button" data-close="true">×</button>
    </div>
    <div class="modal__body" id="modalContent">
      <div class="empty">Selectionne un jour dans le calendrier.</div>
    </div>
  </div>
</div>

{% endblock %}
